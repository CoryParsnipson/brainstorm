{% extends "blog/default_page.html" %}

{% block content %}
<!-- variables passed from back end -->
<input type="hidden" name="be_idea_detail_url" value="{% url 'idea_detail' '' %}">
<input type="hidden" name="be_csrf_token" value="{% csrf_token %}">

<!-- page start -->
<h1><a href="{% url 'index' %}">Slacker Paradise</a> :: Dashboard</h1>

<h2>Ideas:</h2>
<ul id="idea_list"></ul>
<hr>
<div id="form_idea_container"></div>

<script type="text/javascript">
var be_params = getBeParams();

function getIdeas(ideas)
{
  var list_html = "";

  // idea detail url
  var idea_url = be_params["be_idea_detail_url"];
  idea_url = idea_url.substring(0, idea_url.length - 1);

  for (var i = 0; i < ideas.length; i++)
  {
    list_html += "<li>";
    list_html += "<a href=" + idea_url + ideas[i].slug + ">";
    list_html += ideas[i].name + "</a>: ";
    list_html += ideas[i].description + "</li>\n";
  }

  document.getElementById("idea_list").innerHTML = list_html;
}
ajax({ url: "/api/ideas",
       method: "GET",
       callback: getIdeas });

// create Idea form
function populateIdeaForm(form_data)
{
  var form = createForm({ id: "form_idea",
                          action: "{% url 'forms-idea' %}",
                          method: "post",
                          csrf_token: be_params["be_csrf_token"],
                          form_body: form_data["form"],
                          submit: "New Idea" });

  // add a little header
  var tbody = form.getElementsByTagName("tbody")[0];
  tbody.insertRow(0);
  tbody.rows[0].insertCell(0);
  tbody.rows[0].cells[0].innerHTML = "<h3>New Idea:</h3>";

  document.getElementById("form_idea_container").appendChild(form);

  function submit_action(event)
  {
    event.preventDefault();

    // post to submit form data
    ajax({ url: "{% url 'forms-idea' %}",
           method: "post",
           data: {}}); // TODO: populate data object

    // get to refresh page
    ajax({ url: "{% url 'idea-list' %}",
           method: "get",
           callback: getIdeas});
  }
  var submit_field = tbody.querySelector('#id_submit');
  EventLib.addEvent(submit_field, "click", submit_action);
}
ajax({ url: "{% url 'forms-idea' %}",
       method: "GET",
       callback: populateIdeaForm });
</script>
{% endblock %}