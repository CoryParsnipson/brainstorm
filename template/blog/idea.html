{% extends "blog/default_page.html" %}

{% block content %}
<!-- variables passed from back end -->
<input type="hidden" name="be_idea_id" value="{{ idea_id }}">
<input type="hidden" name="be_csrf_token" value="{% csrf_token %}">

<!-- page start -->
<h1><a href="{% url 'index' %}">Slacker Paradise</a> :: <span id="idea_name"></span></h1>
<a href="{% url 'dashboard' %}">Dashboard</a>

<h2 id="idea_header"></h2>
<p id="idea_description"></p>
<hr>

<h2>Latest thoughts:</h2>
<div id="thought_list"></div>
<hr>

<div id="new_thought_container"></div>

<script type="text/javascript">
// obtain any back end parameters
var be_params = getBeParams();

function getIdeaInfo(idea)
{
  document.getElementById("idea_name").innerHTML = idea.name;
  document.getElementById("idea_header").innerHTML = idea.name;
  document.getElementById("idea_description").innerHTML = idea.description;
}
ajax("/api/ideas/" + be_params["be_idea_id"], "GET", getIdeaInfo);

// populate thoughts list
function populateThoughtList(thoughts)
{
  var thought_list = document.getElementById("thought_list");

  var thought_html = "";
  for (var thought_idx = 0; thought_idx < thoughts.length; thought_idx++)
  {
    thought_html += "<p style='font-weight: bold;'>" + thoughts[thought_idx].title + "</p>";
    thought_html += "<p>" + thoughts[thought_idx].content + "</p>";

    if (thought_idx != thoughts.length - 1)
    {
      thought_html += "<hr>\n";
    }
  }
  thought_list.innerHTML = thought_html;
}
ajax("/api/ideas/" + be_params["be_idea_id"] + "/thoughts/", "GET", populateThoughtList);

// create new thought form
function createNewThoughtForm(form_data)
{
  var container = document.getElementById("new_thought_container");
  var form = createForm("form_thought",
                        "{% url 'forms-thought' %}",
                        "post",
                        be_params["be_csrf_token"],
                        form_data["form"],
                        "Publish");

  container.appendChild(form);
}
ajax("/api/forms/thought/", "GET", createNewThoughtForm);
</script>
{% endblock %}