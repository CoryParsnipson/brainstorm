{% extends "blog/default_page.html" %}

{% block content %}
<!-- variables passed from back end -->
<input type="hidden" name="be_idea_id" value="{{ idea_id }}">
<input type="hidden" name="be_csrf_token" value="{% csrf_token %}">

<!-- content start -->
<h1 id="idea_name"></h1>
<p id="idea_description"></p>
<p>Latest thoughts:</p>
<div id="thought_list"></div>

<div id="idea_create_form" style="border: 1px solid black;"></div>

<script type="text/javascript">
  // obtain any back end parameters
  var beParams = getBeParams();

  function getIdeaInfo(idea)
  {
    document.getElementById("idea_name").innerHTML = idea.name;
    document.getElementById("idea_description").innerHTML = idea.description;
  }

  ajax("/api/ideas/" + beParams["be_idea_id"], "GET", getIdeaInfo);

  // populate thoughts list
  function populateThoughtList(thoughts)
  {
    var thought_list = document.getElementById("thought_list");

    var thought_html = "";
    for (var thought_idx = 0; thought_idx < thoughts.length; thought_idx++)
    {
      thought_html += "<p style='font-weight: bold;'>" + thoughts[thought_idx].title + "</p>";
      thought_html += "<p>" + thoughts[thought_idx].content + "</p>";
      thought_html += "<hr>\n";
    }
    thought_list.innerHTML = thought_html;
  }

  ajax("/api/ideas/" + beParams["be_idea_id"] + "/thoughts/", "GET", populateThoughtList);

  // try programmatically populating a form
  function populateIdeaForm(form_data)
  {
    // make form element
    var form = createFormContainer('test', '', "post", beParams["be_csrf_token"], "Create!");

    // populate form content body
    var parser = new DOMParser();
    var form_content = document.createDocumentFragment();
    form_content.appendChild(parser.parseFromString(form_data["form"], "text/html").firstChild);

    // populate form
    form.insertBefore(form_content, form.firstChild);

    // add form to document
    document.getElementById("idea_create_form").innerHTML = form.innerHTML;
  }
  ajax("/api/forms/ideas/", "GET", populateIdeaForm);
</script>
{% endblock %}