{% extends 'blog/templates/template_dashboard.html' %}
{% load staticfiles %}

{% block content %}
<h1>{{ request.user.username }}'s Dashboard<hr></h1>

<!-- two column layout -->
<div class="row">
    <div class="large-6 columns">
        <div class="dashboard-panel">
            <h3><a name="manage_ideas">Manage Ideas</a></h3>
            <!-- new idea form section -->
            <form action="{% url 'forms-idea' %}" method="post">
                {% csrf_token %}
                <table class="add-idea">
                    <tbody>
                    <tr>
                        <td id="name-cell">{{ idea_form.name.label_tag }}{{ idea_form.name }}</td>
                        <td id="slug-cell">{{ idea_form.slug.label_tag }}{{ idea_form.slug }}</td>
                        <td id="description-cell">{{ idea_form.description.label_tag }}{{ idea_form.description }}</td>
                        <td id="submit-cell">
                            {% if "edit_idea" in request.GET %}
                            <input id="id_submit" type="submit" value="Edit">
                            {% else %}
                            <input id="id_submit" type="submit" value="Create">
                            {% endif %}
                        </td>
                    </tr>
                    </tbody>
                </table>
            </form>

            <!-- manage ideas form -->
            <table class="editable">
                <tr class="header">
                    <td>Name</td>
                    <td>Slug</td>
                    <td>Description</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                {% for idea in ideas %}
                <tr>
                    <form action="" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="idea" value="{{ idea.slug }}" />
                        <td title="{{ idea.slug }}"><a href="{% url 'dashboard' %}?idea_slug={{ idea.slug }}">{{ idea.name }}</a></td>
                        <td>{{ idea.slug }}</td>
                        <td class="expand">{{ idea.description }}</td>
                        <td class="button-box"><input type="submit" name="order_up" value="^"></td>
                        <td class="button-box"><input type="submit" name="order_down" value="v"></td>
                        <td class="button-box"><input type="submit" name="edit" value="e"></td>
                        <td class="button-box"><input type="submit" name="delete" value="x"></td>
                    </form>
                </tr>
                {% endfor %}
            </table>

            <ul class="pagination">
                {% for idea_page in idea_pages %}
                <li><a href="{% url 'dashboard' %}?idea_slug={{ request.GET.idea_slug }}&page={{ idea_page }}#manage_ideas">{{ idea_page }}</a></li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="large-6 columns">
        <div class="dashboard-panel">
            <h3><a name="post_new_thought">Post New Thought</a></h3>
            {% if "idea_slug" in request.GET %}
            {% with "idea_slug="|add:request.GET.idea_slug as q %}
              {% include 'blog/templates/template_thought.html' with form=thought_form idea=request.GET.idea_slug author=request.user.id q=q %}
            {% endwith %}
            {% else %}
              {% include 'blog/templates/template_thought.html' with form=thought_form idea=request.GET.idea_slug author=request.user.id %}
            {% endif %}
            <hr>

            <h3>
                <a name="manage_thoughts">Manage Thoughts {% if request.GET.idea_slug %} ({{ request.GET.idea_slug }}) {% endif %}</a>
            </h3>
            <table class="editable">
                <tbody>
                <tr>
                    <td>Date</td>
                    <td>Title</td>
                    <td>Trash</td>
                    <td class="shrink">[e]</td>
                    <td class="shrink">[x]</td>
                </tr>

                {% for thought in thoughts %}
                <tr>
                    <form action="{% url 'dashboard-manage-thought' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="thought_slug" value="{{ thought.slug }}" />
                        <input type="hidden" name="idea_slug" value="{{ thought.idea.slug }}" />
                        <td>{{ thought.date_published|date:"N n Y" }}</td>
                        <td>{{ thought.title }}</td>
                        <td>{{ thought.is_trash }}</td>
                        <td><input class="button-box" type="submit" name="edit" value="e" /></td>
                        <td><input class="button-box" type="submit" name="delete" value="x" /></td>
                    </form>
                </tr>
                {% empty %}
                <tr><td colspan="4">There are no thoughts in this Idea.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}